#!/usr/bin/env python
# coding=utf-8
"""
Usage: wiva <url> [ <revision> ] [ --verbose ] [ --debug ] [ --check-wikitext ]
"""
import logging
import docopt
from mediawiki import Article
from validation import Validation
from wikitext.lexer import tokenize
from wikitext.parser import parse
from wikitext_checkers import ALL_CHECKERS

logger = logging.getLogger(__name__)
logging.basicConfig(level=logging.WARNING)


def cli(arguments):
    if arguments['--debug']:
        logging.root.setLevel(logging.DEBUG)

    article = Article(arguments['<url>'])
    if arguments['--check-wikitext']:
        validation = Validation(article,ALL_CHECKERS)
        for message in validation.messages:
            print message
        return

    wikitext = article.wikitext
    if arguments['--verbose']:
        print "Wikitext:"
        print
        print wikitext
        print

    if arguments['--verbose']:
        print "Tokens:"
        print
        print tokenize(wikitext)
        print

    print parse(wikitext)


if __name__ == '__main__':
    arguments = docopt.docopt(__doc__)
    cli(arguments)

__author__ = 'alistra'
