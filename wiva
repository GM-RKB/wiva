#!/usr/bin/env python
# coding=utf-8
"""
Usage: wiva <url> [ <revision> ] [ --verbose ] [ --debug ] [ --check-wikitext ] [ --wikitext=<wikitext_file> ]
"""
import logging
import docopt
from mediawiki import Article
from validation import Validation
from parens.parser import parse
from wikitext_checkers import ALL_CHECKERS

logger = logging.getLogger(__name__)
logging.basicConfig(level=logging.WARNING)


def cli(arguments):
    if arguments['--debug']:
        logging.root.setLevel(logging.DEBUG)

    article = Article(arguments['<url>'])
    if arguments['--wikitext']:
        with open(arguments['--wikitext'], 'r') as f:
            article._wikitext = f.read()
    if arguments['--check-wikitext']:
        validation = Validation(article,ALL_CHECKERS)
        for message in validation.messages:
            print message
        return

    wikitext = article.wikitext
    for a in parse(wikitext):
        print a

if __name__ == '__main__':
    arguments = docopt.docopt(__doc__)
    cli(arguments)

__author__ = 'alistra'
